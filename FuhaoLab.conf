#!/bin/bash

### Please configure ###

if [ -z "$PROGPATH" ]; then
	export PROGPATH=${HOME}/Programs;
fi
if [ -z "$BIODATABASES" ]; then
	export BIODATABASES=${HOME}/Databases;
fi
if [ -z "$InstallPlatform" ]; then
	InstallPlatform='PC'
fi
if [ -z "$EnvironFilePath" ]; then
	export EnvironFilePath=${HOME}/.bashrc
fi

### Configure End ###






###Please configure InstallPlatform
# For Linux cluster, choose HPC
#InstallPlatform='HPC'
#For personal PC or workstation
#InstallPlatform='PC'
if [[ $InstallPlatform == "PC" ]]; then
	export EnvironFilePath=${HOME}/.bashrc
elif [[ $InstallPlatform == "HPC" ]]; then
	if [ ! -d ${PROGPATH}/bin ]; then
		mkdir -p ${PROGPATH}/bin
	fi
	export EnvironFilePath=${PROGPATH}/bin/myprogram
else
	export EnvironFilePath=${HOME}/.bashrc
fi






###echo color
#Black        0;30     Dark Gray     1;30
#Red          0;31     Light Red     1;31
#Green        0;32     Light Green   1;32
#Brown/Orange 0;33     Yellow        1;33
#Blue         0;34     Light Blue    1;34
#Purple       0;35     Light Purple  1;35
#Cyan         0;36     Light Cyan    1;36
#Light Gray   0;37     White         1;37
#RED=\'\033[0;31m\'
#NC=\'\033[0m\' # No Color
#printf "I ${RED}love${NC} Stack Overflow\n"
function RunCmds() {
	RCcmd=$1;
	
	$RCcmd
	if [ $? -ne 0 ]; then
		echo -e "\033[43;31mError: cmd failed\033[0m" >&2
		echo "CMD: $RCcmd" >&2
		exit 100
	else
		return 0
	fi
}




### Print important info
function PrintInfo() {
	local PTmessage=$1
	
	echo -e "\033[43;31m${PTmessage}\033[0m"
	return 0
}


if [ ! -z $(uname -m) ]; then
	export MACHTYPE=$(uname -m)
elif [ ! -z "$MACHTYPE" ]; then
	MTemp=${MACHTYPE%%-*}
	export MACHTYPE=$MTemp
else
	PrintInfo "Warnings: unknown MACHTYPE, set to default x86_64" >&2
	export MACHTYPE="x86_64"
fi


### change to install path
function CheckPath() {
	local CPname=$1
	local CPvers=$2
	
	local CPinstall_path=$PROGPATH/$CPname/$CPvers
	echo "Install Path: $CPinstall_path"

	if [ ! -d $CPinstall_path ]; then
		mkdir -p $CPinstall_path
	fi
	cd $CPinstall_path
	return 0;
}

### change to install LIB path
function CheckLibPath() {
	local CPname=$1
	local CPvers=$2
	
	local CPinstall_path=${PROGPATH}/libraries/$CPname/$CPvers
	echo "Install Path: $CPinstall_path"

	if [ ! -d $CPinstall_path ]; then
		mkdir -p $CPinstall_path
	fi
	
	cd $CPinstall_path
	
	return 0;
}


### Download using wget
function DownloadWget() {
	local DWlink=$1
	local DWname=$2
	
	
	if [ ! -s $DWname ]; then
		echo "Downloading $DWname from $DWlink"
		wget --tries 5 -c $DWlink -O $DWname
		if [ $?  -ne 0 ]; then
			echo "Error: failed to download package $DWname" >&2
			echo "CMD used: wget -c $DWlink -O $DWname" >&2
			echo "Please retry or manually download the package from $DWlink, "
			echo "    and rename it to $DWname"
			exit 100
		fi
	else
		echo "Info: existing $DWname"
	fi
	
	return 0
}



### Environment
function AddEnvironVariable() {
	local EVpath=$1
	local EVcomt=$2
	echo "### $PackageName-$PackageVers" >> $EnvironFilePath
	
	echo "### $EVcomt" >> $EnvironFilePath
	if [ -d $EVpath/bin ]; then
		PrintInfo "#Info: if you want it in effect immediately"
		PrintInfo "export PATH=$EVpath/bin:\$PATH"
		echo "#Info: adding to PATH to $EnvironFilePath"
		echo "export PATH=$EVpath/bin:\$PATH" >> $EnvironFilePath
	else
		PrintInfo "#Info: if you want it in effect immediately"
		PrintInfo "export PATH=$EVpath:\$PATH"
		echo "#Info: adding to PATH to $EnvironFilePath"
		echo "export PATH=$EVpath:\$PATH" >> $EnvironFilePath
	fi
	
	if [ -d $EVpath/lib ]; then
		PrintInfo "#Info: if you want it in effect immediately"
		PrintInfo "export LIBRARY_PATH=$EVpath/lib:\$LIBRARY_PATH"
		PrintInfo "export LD_LIBRARY_PATH=$EVpath/lib:\$LD_LIBRARY_PATH"
		echo "#Info: adding Libs to $EnvironFilePath"
		echo "export LIBRARY_PATH=$EVpath/lib:\$LIBRARY_PATH" >> $EnvironFilePath
		echo "export LD_LIBRARY_PATH=$EVpath/lib:\$LD_LIBRARY_PATH" >> $EnvironFilePath
		
		if [ -d $EVpath/lib/pkgconfig ]; then
			PrintInfo "#Info: if you want it in effect immediately"
			PrintInfo "export PKG_CONFIG_PATH=$EVpath/lib/pkgconfig:\$PKG_CONFIG_PATH"
			echo "#Info: adding Libs to $EnvironFilePath"
			echo "export PKG_CONFIG_PATH=$EVpath/lib/pkgconfig:\$PKG_CONFIG_PATH" >> $EnvironFilePath
		fi
	fi
	if [ -d $EVpath/include ]; then
		PrintInfo "#Info: if you want it in effect immediately"
		PrintInfo "export C_INCLUDE_PATH=$EVpath/include:\$C_INCLUDE_PATH"
		PrintInfo "export CPLUS_INCLUDE_PATH=$EVpath/include:\$CPLUS_INCLUDE_PATH"
		echo "#Info: adding headers to $EnvironFilePath"
		echo "export C_INCLUDE_PATH=$EVpath/include:\$C_INCLUDE_PATH" >> $EnvironFilePath
		echo "export CPLUS_INCLUDE_PATH=$EVpath/include:\$CPLUS_INCLUDE_PATH" >> $EnvironFilePath
	fi
	if [ -d $EVpath/share/man ]; then
		PrintInfo "#Info: if you want it in effect immediately"
		PrintInfo "export MANPATH=$EVpath/share/man:\$MANPATH"
		echo "#Info: adding headers to $EnvironFilePath"
		echo "export MANPATH=$EVpath/share/man:\$MANPATH" >> $EnvironFilePath
	fi
### to be continued
}



function AddBashrc () {
	local ABstr=$1
	
	PrintInfo "$ABstr"
	echo "$ABstr" >> $EnvironFilePath
	
	return 0
}



function CheckPythonModules () {
	local CMname=$1
	
	if [ ! -x ${HOME}/.local/bin/$CMname ]; then
		return 1;
	fi
	
	return 0
}
